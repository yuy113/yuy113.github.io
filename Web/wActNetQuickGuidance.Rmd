---
title: "Active subnetwork detection Quick Start"
author: "Yubing Yao"
date: '2023-05-17'
output: 
  rmdformats::robobook:
    code_folding: show
    toc_depth: 3
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Install and Load the `wActNet` Package


Begin by installing and loading the `devtools` package, then using the `install_github` function to install wActNet from GitHub as follows and we also need additional 2 R packages of `igraph` and `BioNet` from BioConductor <https://www.bioconductor.org/install/>.



```{r,results='hide' }
#please comment the below code out if you already install the package-wActNet from github
#library(devtools)
#if (!requireNamespace("BiocManager", quietly = TRUE))
#  install.packages("BiocManager")
#BiocManager::install("pathview")
#install_github("yuy113/wActNet")

library(wActNet)
#R package BioNet from BioConductor 
library(BioNet)
library(igraph)
```

## Simulate data and generate P values of tests on pairwise correlations

To illustrate the process, we begin by generating pairwise correlation data through the simulation of random data, which follows a multivariate normal distribution. Subsequently, we conduct multiple nonparametric permutation tests for all the pairwise correlations within the simulated data. Using the function `pval.perm.corr`, we obtain the corresponding P-values from these permutation tests.

```{r}
dat1<-matrix(rnorm(4000),ncol=40,nrow=100)
colnames(dat1)<-paste("Var", as.character(1:40),sep="")
pval.edge<-pval.perm.corr(dat1,nsim=100,MatchId=NULL,do.parallel=FALSE)
#pval.edge
```

## Calculate node scores and edge scores 

As an example for detecting all possible optimized subnetworks on simulated network data, we can utilize the approach proposed by Dittrich et al. in 2008 to use node scores only. However, we can further enhance the method by incorporating weighted combined node scores and edge scores using our proposed algorithm implemented in `wActNet` R package. This can be achieved through the implementation of the function `MultiModuleFind` within the R package.

Within the `MultiModuleFind` function, we have the flexibility to set the maximum number of active subnetworks (`ncluster`) and choose between two methods: the one presented by Dittrich et al. in 2008 (`NodeOnly`) or our proposed method (`NodeEdge`). By specifying the method parameter, we can determine the preferred approach for analyzing the data.

Furthermore, our proposed algorithm, which is implemented in the `wActNet` R package, allows us to fine-tune the optimization of active subnetworks by adjusting the parameter `weightratio.edge.node`. This parameter represents the weighted ratio between edge scores and node scores in the objective function.

In summary, by combining the methodology introduced by Dittrich et al. with our own enhancements, including weighted node and edge scores, and utilizing the `MultiModuleFind` function with adjustable parameters, we can effectively detect the optimized active subnetworks on network data.


```{r}
# simulate the p values for all the possible edges in the network
ind.pos.pval.edge<-rbinom(40*39/2,1,0.5)
pval.edge<-(1-ind.pos.pval.edge)*runif(40*39/2)+ind.pos.pval.edge*rbeta(40*39/2,0.1,1)
names(pval.edge)<-unlist(sapply(1:39,function(i){sapply((i+1):40, function(j){paste(paste("Var",
as.character(i),sep=""),paste("Var",as.character(j),sep=""),sep="_")})}))

# simulate p values for all the nodes in the network
ind.pos.pval.node<-rbinom(40,1,0.2)
pval.node<-(1-ind.pos.pval.node)*runif(40)+ind.pos.pval.node*rbeta(40,0.1,1)
names(pval.node)<-paste("Var", as.character(1:40),sep="")

# generate the node score-NodeScore, edge scores-EdgeScore and igraph object-Network
network.test<-uniform.beta.node.edge.score(pval.node,pval.edge,0.05,0.05,dat1)

#igraph object-Network
network.test$Network
#node scores
network.test$NodeScore
#edge scores
#network.test$EdgeScore
```


## Detect optimized subnetworks 
To detect all possible optimized subnetworks on simulated network data, we can illustrate through the following example. We will utilize two methods: the approach introduced by Dittrich et al. in 2008, which is based on node scores only, and our proposed method, which incorporates weighted sum of node scores and edge scores. These methods can be invoked through the function `MultiModuleFind`.

Within the `MultiModuleFind` function, we have the flexibility to set the maximum number of active subnetworks (`ncluster`) and choose between the two methods, either `NodeOnly` for Dittrich et al.'s method or `NodeEdge` for our proposed method, using the `method` parameter.

In our proposed method, which is implemented in the `wActNet` R package, we have an additional adjustable parameter called `weightratio.edge.node`. This parameter allows us to specify the weighted ratio of edge scores versus node scores in the objective function for optimizing active subnetworks.


```{r}
network.test1<-network.test$Network
node.scores<-network.test$NodeScore
edge.scores<-network.test$EdgeScore
#Note: both BioNet and wActNet R packages stop running and can't detect any optimized/active subnetwork further and complete, a warning output message-"No positive node" will be generated.
#identify all possible optimized subnetworks in simulated network
# using Dittrich's method using node scores only
multi.mod.n<-MultiModuleFind(network.test1,node.scores,edge.scores,
weightratio.edge.node=1,ncluster=3,method="NodeOnly")
#all possible optimized subnetworks in simulated network using Dittrich's method using node scores only
multi.mod.n
# identify all possible signaling modules in simulated network
# using our proposed method based on node scores and edge scores
multi.mod.e<-MultiModuleFind(network.test1,node.scores,edge.scores,
weightratio.edge.node=1,ncluster=3,method="NodeEdge")
#all possible optimized subnetworks in simulated network using our proposed method based on node scores and edge scores
multi.mod.e
```


## Contact Us / Contribute
This package is new, and any and all suggestions are welcomed. You can use GitHub to raise issues, contribute, or communicate with us about the package:

https://github.com/yuy113/wActNet/

## Reference

Dittrich, M., Klau, G., Rosenwald, A., Dandekar, T., Müller, T.: Identifying functional modules in protein-protein interaction
networks: an integrated exact approach. Bioinformatics 24(13), 223–231 (2008)

Beisser, D., Klau, G., Dandekar, T., Müller, T., Dittrich, M.: Bionet: an r-package for the functional analysis of biological
networks. Bioinformatics 26(8), 1129–1130 (2010)

